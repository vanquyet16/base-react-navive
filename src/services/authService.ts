import api from './api';
import { LoginRequest, LoginResponse, User, AuthTokens } from '@/types';

// Mock data cho development
// const MOCK_USER: User = {
//     id: '1',
//     userName: 'user@example.com',
//     name: 'Ng∆∞·ªùi d√πng Demo',
//     avatar: 'https://i.pravatar.cc/150?img=1',
//     role: 'user'
// };

// const MOCK_TOKENS: AuthTokens = {
//     accessToken: 'mock_access_token_12345',
//     refreshToken: 'mock_refresh_token_67890'
// };

export const authService = {
    // ƒêƒÉng nh·∫≠p - Mock API cho development
    login: async (credentials: LoginRequest): Promise<LoginResponse> => {
        console.log("üöÄ ~ credentials:", credentials)

        const response = await api.post('api/Account/Login', {
            matKhau: credentials.password,
            taiKhoan: credentials.userName
        });

        // Ki·ªÉm tra response success
        if (!response.data.success) {
            throw new Error(response.data.error || 'ƒêƒÉng nh·∫≠p th·∫•t b·∫°i');
        }

        return response.data;
        // Gi·∫£ l·∫≠p delay API call

        // Mock th√†nh c√¥ng v·ªõi b·∫•t k·ª≥ email/password n√†o
        // return {
        //     user: {
        //         ...MOCK_USER,
        //         userName: credentials.userName
        //     },
        //     tokens: MOCK_TOKENS
        // };
    },

    // ƒêƒÉng k√Ω
    register: async (userData: {
        email: string;
        password: string;
        name: string;
    }): Promise<LoginResponse> => {
        const response = await api.post('/auth/register', userData);

        // Ki·ªÉm tra response success
        if (!response.data.success) {
            throw new Error(response.data.error || 'ƒêƒÉng k√Ω th·∫•t b·∫°i');
        }

        return response.data;


        // await new Promise(resolve => setTimeout(resolve, 1000));

        // return {
        //     user: {
        //         ...MOCK_USER,
        //         email: userData.email,
        //         name: userData.name
        //     },
        //     tokens: MOCK_TOKENS
        // };
    },

    // L√†m m·ªõi token
    refreshToken: async (refreshToken: string): Promise<AuthTokens> => {
        const response = await api.post('/auth/refresh', { refreshToken });
        return response.data.tokens;
    },

    // ƒêƒÉng xu·∫•t
    logout: async (): Promise<void> => {
        await new Promise(resolve => setTimeout(resolve, 500));
    },

    // L·∫•y th√¥ng tin ng∆∞·ªùi d√πng hi·ªán t·∫°i
    getCurrentUser: async (): Promise<User> => {

        const response = await api.get('/auth/me');
        return response.data;
        // await new Promise(resolve => setTimeout(resolve, 500));
        // return MOCK_USER;
    },

    // C·∫≠p nh·∫≠t h·ªì s∆°
    updateProfile: async (userData: Partial<User>): Promise<User> => {
        const response = await api.put('/auth/profile', userData);
        return response.data;
    },

    // ƒê·ªïi m·∫≠t kh·∫©u
    changePassword: async (data: {
        currentPassword: string;
        newPassword: string;
    }): Promise<void> => {
        await api.post('/auth/change-password', data);
    },

    // Qu√™n m·∫≠t kh·∫©u
    forgotPassword: async (email: string): Promise<void> => {
        await api.post('/auth/forgot-password', { email });
    },

    // ƒê·∫∑t l·∫°i m·∫≠t kh·∫©u
    resetPassword: async (data: {
        token: string;
        password: string;
    }): Promise<void> => {
        await api.post('/auth/reset-password', data);
    },
}; 